#!/bin/sh

NODE=netspire

ERL=%%ERL%%
NETSPIRE_DB=%%SPOOLDIR%%
NETSPIRE_EBIN=%%BEAMDIR%%
NETSPIRE_CONFIG=%%NETSPIRE_CONFIG%%

start()
{
    for dir in $NETSPIRE_DB $NETSPIRE_EBIN; do
        [ ! -d $dir ] && echo "$dir does not exists" && exit 1
    done
    [ ! -f $NETSPIRE_CONFIG ] &&
        echo "Configuration file does not exists" && exit 1
    %%ERL%% \
    -noinput -detached \
    -sname $NODE \
    -pa $NETSPIRE_EBIN \
    -mnesia dir "\"$NETSPIRE_DB\"" \
    -netspire config \"$NETSPIRE_CONFIG\" \
    -eval 'application:start(netspire).'
}

usage()
{
    echo "usage: $0 start"
    exit 0
}

[ $# -lt 1 ] && usage

case $1 in
    start) start;;
    *) usage;;
esac
